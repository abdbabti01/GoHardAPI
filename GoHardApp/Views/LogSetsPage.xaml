<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:GoHardApp.ViewModels"
             xmlns:model="clr-namespace:GoHardApp.Models"
             x:Class="GoHardApp.Views.LogSetsPage"
             x:DataType="viewmodel:LogSetsViewModel"
             Title="Log Sets">

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Padding="20" Spacing="5">
            <Label Text="Exercise Sets"
                   FontSize="20"
                   FontAttributes="Bold"/>
            <Label Text="Add and track your sets"
                   FontSize="14"
                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray200}}"/>
        </VerticalStackLayout>

        <!-- Sets List -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="10" Spacing="10">
                <!-- Existing Sets -->
                <CollectionView ItemsSource="{Binding Sets}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="model:ExerciseSet">
                            <SwipeView>
                                <SwipeView.RightItems>
                                    <SwipeItems>
                                        <SwipeItem Text="Delete"
                                                  BackgroundColor="Red"
                                                  Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:LogSetsViewModel}}, Path=DeleteSetCommand}"
                                                  CommandParameter="{Binding .}"/>
                                    </SwipeItems>
                                </SwipeView.RightItems>

                                <Frame Margin="5" Padding="15" CornerRadius="10"
                                      HasShadow="True">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <!-- Set Number -->
                                        <Label Grid.Column="0"
                                              Text="{Binding SetNumber, StringFormat='Set {0}'}"
                                              FontSize="16"
                                              FontAttributes="Bold"
                                              VerticalOptions="Center"/>

                                        <!-- Reps and Weight -->
                                        <VerticalStackLayout Grid.Column="1" Spacing="2" Margin="15,0">
                                            <Label Text="{Binding Reps, StringFormat='{0} reps'}"
                                                  FontSize="14"/>
                                            <Label Text="{Binding Weight, StringFormat='{0} kg'}"
                                                  FontSize="14"
                                                  TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray200}}"
                                                  IsVisible="{Binding Weight, Converter={StaticResource IsNotNullConverter}}"/>
                                        </VerticalStackLayout>

                                        <!-- Complete Button -->
                                        <Button Grid.Column="2"
                                               Text="âœ“"
                                               Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:LogSetsViewModel}}, Path=CompleteSetCommand}"
                                               CommandParameter="{Binding .}"
                                               IsEnabled="{Binding IsCompleted, Converter={StaticResource InvertedBoolConverter}}"
                                               WidthRequest="40"
                                               HeightRequest="40"
                                               CornerRadius="20"
                                               FontSize="18"/>
                                    </Grid>
                                </Frame>
                            </SwipeView>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Add New Set Form -->
        <Frame Grid.Row="2" Padding="15" Margin="10" CornerRadius="15" HasShadow="True"
              BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}">
            <VerticalStackLayout Spacing="10">
                <Label Text="Add New Set"
                      FontSize="16"
                      FontAttributes="Bold"/>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                    <VerticalStackLayout Grid.Column="0" Spacing="5">
                        <Label Text="Reps"
                              FontSize="12"/>
                        <Entry Text="{Binding NewSetReps}"
                              Keyboard="Numeric"
                              Placeholder="10"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Column="1" Spacing="5">
                        <Label Text="Weight (kg)"
                              FontSize="12"/>
                        <Entry Text="{Binding NewSetWeight}"
                              Keyboard="Numeric"
                              Placeholder="0"/>
                    </VerticalStackLayout>
                </Grid>

                <Button Text="Add Set"
                       Command="{Binding AddSetCommand}"
                       HeightRequest="45"
                       FontAttributes="Bold"/>
            </VerticalStackLayout>
        </Frame>
    </Grid>

</ContentPage>
