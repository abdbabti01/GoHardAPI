<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:GoHardApp.ViewModels"
             xmlns:model="clr-namespace:GoHardApp.Models"
             x:Class="GoHardApp.Views.SessionsPage"
             x:DataType="viewmodel:SessionsViewModel"
             Title="My Workouts">

    <Grid>
        <RefreshView IsRefreshing="{Binding IsLoading}"
                     Command="{Binding LoadSessionsCommand}">
            <CollectionView ItemsSource="{Binding Sessions}">
                <CollectionView.EmptyView>
                    <VerticalStackLayout HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       Padding="24">
                        <Label Text="No workouts yet!"
                               FontSize="22"
                               FontFamily="OpenSansSemibold"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Start logging your training sessions"
                               FontSize="15"
                               FontFamily="OpenSansRegular"
                               TextColor="{AppThemeBinding Light={StaticResource iOSSecondaryLabel}, Dark={StaticResource iOSDarkSecondaryLabel}}"
                               HorizontalTextAlignment="Center"
                               Margin="0,8,0,0" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="model:Session">
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="Delete"
                                             BackgroundColor="{StaticResource ErrorRed}"
                                             Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:SessionsViewModel}}, Path=DeleteSessionCommand}"
                                             CommandParameter="{Binding .}" />
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <Frame Margin="20,0,20,16"
                                   Padding="16"
                                   CornerRadius="16"
                                   HasShadow="True"
                                   BackgroundColor="{AppThemeBinding Light={StaticResource CardBackgroundLight}, Dark={StaticResource CardBackgroundDark}}">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:SessionsViewModel}}, Path=ViewSessionCommand}"
                                                         CommandParameter="{Binding .}" />
                                </Frame.GestureRecognizers>

                                <Grid RowDefinitions="Auto,Auto,Auto,Auto"
                                      ColumnDefinitions="*,Auto"
                                      RowSpacing="8">

                                    <!-- Date -->
                                    <Label Grid.Row="0" Grid.Column="0"
                                           Text="{Binding Date, StringFormat='{0:MMM dd, yyyy}'}"
                                           FontSize="18"
                                           FontFamily="OpenSansSemibold"
                                           FontAttributes="Bold" />

                                    <!-- Status Badge -->
                                    <Frame Grid.Row="0" Grid.Column="1"
                                           Padding="8,4"
                                           CornerRadius="10"
                                           HasShadow="False"
                                           BorderColor="Transparent">
                                        <Frame.Triggers>
                                            <DataTrigger TargetType="Frame" Binding="{Binding Status}" Value="draft">
                                                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light={StaticResource iOSGray4}, Dark={StaticResource iOSDarkGray4}}" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Frame" Binding="{Binding Status}" Value="in_progress">
                                                <Setter Property="BackgroundColor" Value="{StaticResource WarningOrange}" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Frame" Binding="{Binding Status}" Value="completed">
                                                <Setter Property="BackgroundColor" Value="{StaticResource SuccessGreen}" />
                                            </DataTrigger>
                                        </Frame.Triggers>

                                        <Label TextColor="White"
                                               FontSize="11"
                                               FontAttributes="Bold">
                                            <Label.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding Status}" Value="draft">
                                                    <Setter Property="Text" Value="DRAFT" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label" Binding="{Binding Status}" Value="in_progress">
                                                    <Setter Property="Text" Value="IN PROGRESS" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label" Binding="{Binding Status}" Value="completed">
                                                    <Setter Property="Text" Value="COMPLETED" />
                                                </DataTrigger>
                                            </Label.Triggers>
                                        </Label>
                                    </Frame>

                                    <!-- Duration & Exercise Count -->
                                    <HorizontalStackLayout Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Spacing="24">
                                        <Label Text="{Binding Duration, StringFormat='â±ï¸ {0} min'}"
                                               FontSize="15"
                                               FontFamily="OpenSansRegular"
                                               TextColor="{AppThemeBinding Light={StaticResource iOSSecondaryLabel}, Dark={StaticResource iOSDarkSecondaryLabel}}" />
                                        <Label Text="{Binding Exercises.Count, StringFormat='ðŸ’ª {0} exercises'}"
                                               FontSize="15"
                                               FontFamily="OpenSansRegular"
                                               TextColor="{AppThemeBinding Light={StaticResource iOSSecondaryLabel}, Dark={StaticResource iOSDarkSecondaryLabel}}" />
                                    </HorizontalStackLayout>

                                    <!-- Type Badge -->
                                    <Frame Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                           Padding="8,4"
                                           CornerRadius="12"
                                           BackgroundColor="{AppThemeBinding Light=#E3F2FD, Dark=#1565C0}"
                                           HasShadow="False"
                                           BorderColor="Transparent"
                                           HorizontalOptions="Start">
                                        <Label Text="{Binding Type}"
                                               FontSize="12"
                                               FontFamily="OpenSansRegular"
                                               TextColor="{AppThemeBinding Light={StaticResource InfoBlue}, Dark=White}" />
                                    </Frame>

                                    <!-- Notes -->
                                    <Label Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding Notes}"
                                           FontSize="12"
                                           FontFamily="OpenSansRegular"
                                           TextColor="{AppThemeBinding Light={StaticResource iOSTertiaryLabel}, Dark={StaticResource iOSDarkTertiaryLabel}}"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="2"
                                           IsVisible="{Binding Notes, Converter={StaticResource IsNotNullConverter}}" />
                                </Grid>
                            </Frame>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- Floating Action Button for New Workout -->
        <Button Text="+"
                WidthRequest="64"
                HeightRequest="64"
                CornerRadius="32"
                BackgroundColor="{StaticResource FitnessGradientStart}"
                TextColor="White"
                FontSize="32"
                FontAttributes="Bold"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="24"
                Command="{Binding StartNewWorkoutCommand}" />
    </Grid>
</ContentPage>
